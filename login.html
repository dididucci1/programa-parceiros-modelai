<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Model AI - Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="js/theme.css">
  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    /* Background decoration */
    .bg-blob::before,
    .bg-blob::after { content:''; position: absolute; border-radius: 50%; filter: blur(60px); opacity:.25; }
    .bg-blob::before { width: 320px; height: 320px; background:#14b8a6; left:-80px; top:-80px; }
    .bg-blob::after { width: 280px; height: 280px; background:#a7f3d0; right:-60px; bottom:-60px; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-gray-50 to-gray-100 flex items-center justify-center p-6 relative overflow-hidden">
  <button id="themeToggle" class="absolute top-4 right-4 text-slate-500 hover:text-slate-700" title="Modo escuro">
    <i class="fas fa-moon"></i>
  </button>
  <div class="bg-blob absolute inset-0 pointer-events-none"></div>
  <div class="w-full max-w-md bg-white/90 backdrop-blur rounded-2xl shadow-xl border border-slate-200/60">
    <div class="px-8 pt-8 text-center">
      <img src="./images/image.png" alt="Model AI" class="h-12 mx-auto object-contain" />
      <h1 class="text-2xl font-semibold text-slate-800 mt-3">Bem-vindo</h1>
      <p class="text-sm text-slate-500">Acesse a plataforma de parceiros Model AI</p>
    </div>
    <form id="loginForm" class="px-8 py-6 space-y-4">
      <div id="errorBox" class="hidden rounded-lg border border-red-200 bg-red-50 text-red-700 px-3 py-2 text-sm">
        Erro ao entrar. Verifique suas credenciais.
      </div>
      <div class="relative">
        <label class="block text-sm font-medium text-slate-700 mb-1">E-mail</label>
        <span class="absolute left-3 top-9 text-slate-400"><i class="fas fa-envelope"></i></span>
        <input id="email" type="email" class="w-full border-2 border-slate-200 rounded-lg pl-9 pr-3 py-2 focus:outline-none focus:border-teal-600" placeholder="voce@empresa.com" required />
      </div>
      <div class="relative">
        <label class="block text-sm font-medium text-slate-700 mb-1">Senha</label>
        <span class="absolute left-3 top-9 text-slate-400"><i class="fas fa-lock"></i></span>
        <input id="senha" type="password" class="w-full border-2 border-slate-200 rounded-lg pl-9 pr-10 py-2 focus:outline-none focus:border-teal-600" placeholder="Sua senha" required />
        <button type="button" id="toggleSenha" class="absolute right-3 top-8 text-slate-400 hover:text-slate-600"><i class="fas fa-eye"></i></button>
      </div>
      <div class="flex items-center justify-between">
        <label class="flex items-center gap-2 text-sm text-slate-600">
          <input type="checkbox" id="lembrar" class="rounded border-slate-300" /> Lembrar-me
        </label>
        <a href="#" class="text-sm text-teal-700 hover:text-teal-800">Esqueci minha senha</a>
      </div>
      <div class="pt-2">
        <button id="submitBtn" type="submit" class="w-full inline-flex items-center justify-center gap-2 bg-teal-600 hover:bg-teal-700 text-white font-semibold rounded-lg px-4 py-2 transition">
          <span id="btnIcon"><i class="fas fa-sign-in-alt"></i></span>
          <span id="btnText">Entrar</span>
        </button>
      </div>
      <p class="text-xs text-slate-500 pt-1 text-center">Use seu e-mail e senha cadastrados. Seu perfil (admin/parceiro) virá do banco.</p>
    </form>
    <div class="px-8 pb-6 text-center text-xs text-slate-400">© Model AI</div>
  </div>

  <script src="js/config.js"></script>
  <script src="js/theme.js"></script>
  <script>
    const API = window.API_BASE || '/api';
    // Mostrar/ocultar senha
    document.getElementById('toggleSenha').addEventListener('click', function(){
      const input = document.getElementById('senha');
      const isPass = input.type === 'password';
      input.type = isPass ? 'text' : 'password';
      this.innerHTML = isPass ? '<i class="fas fa-eye-slash"></i>' : '<i class="fas fa-eye"></i>';
    });

    document.getElementById('loginForm').addEventListener('submit', async function(e){
      e.preventDefault();
      const email = (document.getElementById('email').value||'').trim().toLowerCase();
      const senha = (document.getElementById('senha').value||'');
      const errorBox = document.getElementById('errorBox');
      const btn = document.getElementById('submitBtn');
      const btnIcon = document.getElementById('btnIcon');
      const btnText = document.getElementById('btnText');
      errorBox.classList.add('hidden');
      btn.disabled = true; btn.classList.add('opacity-80');
      btnIcon.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
      btnText.textContent = 'Entrando...';
      try {
        const res = await fetch(`${API}/auth/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ email, senha })
        });
        if(!res.ok){
          const err = await res.json().catch(()=>({error:'Erro'}));
          errorBox.textContent = err.error || 'Falha no login';
          errorBox.classList.remove('hidden');
          return;
        }
        const data = await res.json();
        if(data && data.token){
          try { localStorage.setItem('authToken', data.token); } catch {}
        }
        if(data && data.user){
          localStorage.setItem('currentUser', JSON.stringify(data.user));
        }
        window.location.href = 'index.html';
      } catch (e) {
        errorBox.textContent = 'Não foi possível conectar ao servidor.';
        errorBox.classList.remove('hidden');
      }
      btn.disabled = false; btn.classList.remove('opacity-80');
      btnIcon.innerHTML = '<i class="fas fa-sign-in-alt"></i>';
      btnText.textContent = 'Entrar';
    });
  </script>
</body>
</html>
